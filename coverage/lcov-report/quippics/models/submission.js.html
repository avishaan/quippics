<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for quippics/models/submission.js</title>
    <meta charset="utf-8">

    <link rel="stylesheet" href="../../prettify.css">

    <style>
        body, html {
            margin:0; padding: 0;
        }
        body {
            font-family: Helvetica Neue, Helvetica,Arial;
            font-size: 10pt;
        }
        div.header, div.footer {
            background: #eee;
            padding: 1em;
        }
        div.header {
            z-index: 100;
            position: fixed;
            top: 0;
            border-bottom: 1px solid #666;
            width: 100%;
        }
        div.footer {
            border-top: 1px solid #666;
        }
        div.body {
            margin-top: 10em;
        }
        div.meta {
            font-size: 90%;
            text-align: center;
        }
        h1, h2, h3 {
            font-weight: normal;
        }
        h1 {
            font-size: 12pt;
        }
        h2 {
            font-size: 10pt;
        }
        pre {
            font-family: Consolas, Menlo, Monaco, monospace;
            margin: 0;
            padding: 0;
            line-height: 14px;
            font-size: 14px;
            -moz-tab-size: 2;
            -o-tab-size:  2;
            tab-size: 2;
        }

        div.path { font-size: 110%; }
        div.path a:link, div.path a:visited { color: #000; }
        table.coverage { border-collapse: collapse; margin:0; padding: 0 }

        table.coverage td {
            margin: 0;
            padding: 0;
            color: #111;
            vertical-align: top;
        }
        table.coverage td.line-count {
            width: 50px;
            text-align: right;
            padding-right: 5px;
        }
        table.coverage td.line-coverage {
            color: #777 !important;
            text-align: right;
            border-left: 1px solid #666;
            border-right: 1px solid #666;
        }

        table.coverage td.text {
        }

        table.coverage td span.cline-any {
            display: inline-block;
            padding: 0 5px;
            width: 40px;
        }
        table.coverage td span.cline-neutral {
            background: #eee;
        }
        table.coverage td span.cline-yes {
            background: #b5d592;
            color: #999;
        }
        table.coverage td span.cline-no {
            background: #fc8c84;
        }

        .cstat-yes { color: #111; }
        .cstat-no { background: #fc8c84; color: #111; }
        .fstat-no { background: #ffc520; color: #111 !important; }
        .cbranch-no { background:  yellow !important; color: #111; }

        .cstat-skip { background: #ddd; color: #111; }
        .fstat-skip { background: #ddd; color: #111 !important; }
        .cbranch-skip { background: #ddd !important; color: #111; }

        .missing-if-branch {
            display: inline-block;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: black;
            color: yellow;
        }

        .skip-if-branch {
            display: none;
            margin-right: 10px;
            position: relative;
            padding: 0 4px;
            background: #ccc;
            color: white;
        }

        .missing-if-branch .typ, .skip-if-branch .typ {
            color: inherit !important;
        }

        .entity, .metric { font-weight: bold; }
        .metric { display: inline-block; border: 1px solid #333; padding: 0.3em; background: white; }
        .metric small { font-size: 80%; font-weight: normal; color: #666; }

        div.coverage-summary table { border-collapse: collapse; margin: 3em; font-size: 110%; }
        div.coverage-summary td, div.coverage-summary table  th { margin: 0; padding: 0.25em 1em; border-top: 1px solid #666; border-bottom: 1px solid #666; }
        div.coverage-summary th { text-align: left; border: 1px solid #666; background: #eee; font-weight: normal; }
        div.coverage-summary th.file { border-right: none !important; }
        div.coverage-summary th.pic { border-left: none !important; text-align: right; }
        div.coverage-summary th.pct { border-right: none !important; }
        div.coverage-summary th.abs { border-left: none !important; text-align: right; }
        div.coverage-summary td.pct { text-align: right; border-left: 1px solid #666; }
        div.coverage-summary td.abs { text-align: right; font-size: 90%; color: #444; border-right: 1px solid #666; }
        div.coverage-summary td.file { text-align: right; border-left: 1px solid #666; white-space: nowrap;  }
        div.coverage-summary td.pic { min-width: 120px !important;  }
        div.coverage-summary a:link { text-decoration: none; color: #000; }
        div.coverage-summary a:visited { text-decoration: none; color: #333; }
        div.coverage-summary a:hover { text-decoration: underline; }
        div.coverage-summary tfoot td { border-top: 1px solid #666; }

        div.coverage-summary .yui3-datatable-sort-indicator, div.coverage-summary .dummy-sort-indicator {
            height: 10px;
            width: 7px;
            display: inline-block;
            margin-left: 0.5em;
        }
        div.coverage-summary .yui3-datatable-sort-indicator {
            background: url("https://yui-s.yahooapis.com/3.6.0/build/datatable-sort/assets/skins/sam/sort-arrow-sprite.png") no-repeat scroll 0 0 transparent;
        }
        div.coverage-summary .yui3-datatable-sorted .yui3-datatable-sort-indicator {
            background-position: 0 -20px;
        }
        div.coverage-summary .yui3-datatable-sorted-desc .yui3-datatable-sort-indicator {
            background-position: 0 -10px;
        }

        .high { background: #b5d592 !important; }
        .medium { background: #ffe87c !important; }
        .low { background: #fc8c84 !important; }

        span.cover-fill, span.cover-empty {
            display:inline-block;
            border:1px solid #444;
            background: white;
            height: 12px;
        }
        span.cover-fill {
            background: #ccc;
            border-right: 1px solid #444;
        }
        span.cover-empty {
            background: white;
            border-left: none;
        }
        span.cover-full {
            border-right: none !important;
        }
        pre.prettyprint {
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        .com { color: #999 !important; }
        .ignore-none { color: #999; font-weight: normal; }

    </style>
</head>
<body>
<div class="header medium">
    <h1>Code coverage report for <span class="entity">quippics/models/submission.js</span></h1>
    <h2>
        
        Statements: <span class="metric">54.04% <small>(87 / 161)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Branches: <span class="metric">37.31% <small>(25 / 67)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Functions: <span class="metric">48.89% <small>(22 / 45)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        
        Lines: <span class="metric">53.46% <small>(85 / 159)</small></span> &nbsp;&nbsp;&nbsp;&nbsp;
        
        Ignored: <span class="metric"><span class="ignore-none">none</span></span> &nbsp;&nbsp;&nbsp;&nbsp;
    </h2>
    <div class="path"><a href="../../index.html">All files</a> &#187; <a href="index.html">quippics/models/</a> &#187; submission.js</div>
</div>
<div class="body">
<pre><table class="coverage">
<tr><td class="line-count">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417</td><td class="line-coverage"><span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">32</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">32</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-yes">3</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">14</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">32</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">17</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">28</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">28</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">18</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-yes">10</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-yes">15</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">var mongoose = require("mongoose");
var fs = require('fs');
var _ = require('underscore');
var Challenge = require('../models/challenge.js');
var Activity = require('../models/activity.js');
var User = require('../models/user.js');
var Ballot = require('../models/ballot.js');
var Comment = require("../models/comment.js");
var async = require('async');
var logger = require('../logger/logger.js');
var config = require('../conf/config.js');
var mailers = require('../mail/mailers.js');
&nbsp;
var submissionSchema = new mongoose.Schema({
  createdOn: { type: Date, default: Date.now },
  owner: { type: mongoose.Schema.Types.ObjectId, ref: 'User'},
  //these are users who are invited at the creation of the submission
  image:
  { data: Buffer, contentType: String },
  thumbnail:
  { data: Buffer, contentType: String },
  ballots: [Ballot.schema],
  flaggers: [
    { type: mongoose.Schema.Types.ObjectId, ref: 'User' } //list of users who have flagged the submission
  ],
  comments: [Comment.schema],
  score: { type: Number, default: 0}, //we calculate this in the pre save
  rank: { type: Number, default: 0}, //this should be calculated before every ballot added
  challenge: { type: mongoose.Schema.Types.ObjectId, ref: "Challenge"} //we save the challenge id of each submission for easy querying
});
&nbsp;
//do the following before each save
submissionSchema.pre('save', function(next){ //right before saving a new submission, make a new entry in the activity collection
  this.wasNew = this.isNew; //we use this in the post 'save' hook since it has no way to let us know if a doc is/was new
&nbsp;
  if (typeof this.ballots !== "undefined" &amp;&amp; this.isModified()){ //if there are ballots in the submission
    //calculate the average score
    var tot = 0;
    this.ballots.forEach(function(element){
      tot += element.score;
    });
    //calculate and store the score in the document //TODO, this should be done only when a ballot is added, not just a submission
    this.score = tot/this.ballots.length;
    next();
  } else {
    next();
  }
});
&nbsp;
//do following during flag event/hook
submissionSchema.on('flag', <span class="fstat-no" title="function not covered" >function(){</span>
<span class="cstat-no" title="statement not covered" >  console.log('FLAG');</span>
});
&nbsp;
//do the following after each successful save
submissionSchema.post('save', function(){
  if (this.wasNew){
    //emit the specific wasNew event
    this.emit('new');
  } else {
    this.emit('update');
  }
});
&nbsp;
//do the following after save on new instance
submissionSchema.post('new', function(){
  var submission = this;
  //populate the challenge info from the submission
  //TODO add error handling
  submission.populate({
    path: 'challenge',
    select: 'owner title'
  }, function(err, submission){
    //lookup challenge for submission
    <span class="missing-if-branch" title="if path not taken" >I</span>if (err){
&nbsp;
    }
    Challenge.aggregate(
      {$project: {participants: 1}},
      {$match: {_id: submission.challenge._id}},
      {$unwind: "$participants"},
      {$match: {'participants.inviteStatus': {$in: ['invited', 'accepted']}}},
      {$project: {
        inviteStatus: '$participants.inviteStatus',
        user: '$participants.user'
      }}
    ).exec(function(err, participants){
      <span class="missing-if-branch" title="if path not taken" >I</span>if (err){
&nbsp;
      }
      //we have all users that have either accepted or invited to challenge, notify!
      //put returned participants into an array of userids converted to string
      var users = _.map(participants, function(user){return user.user.toString();});
      //add the owner of the challenge to the list
      users.push(submission.challenge.owner.toString());
      //remove the submitter of the challenge from the list
      users = _.difference(users, submission.owner.toString());
      //we need to convert the strings back to objectids
      users = _.map(users, function(user){return mongoose.Types.ObjectId(user);});
      User.sendNotifications({
        users: users,
        payload: {
          alert: {
            'body': 'A new submission was made!',
            'action-loc-key': 'look at submission'
          },
          body: {
            'type': 'submission',
            '_id': submission._id,
            'title': submission.challenge.title
          }
        }
      }, function(err){
        <span class="missing-if-branch" title="if path not taken" >I</span>if (err){
<span class="cstat-no" title="statement not covered" >          logger.error("Error! ", {err: err, stack: new Error().stack});</span>
        }
      });
    });
  });
});
&nbsp;
//keep submission
submissionSchema.statics.keepFlagged = <span class="fstat-no" title="function not covered" >function(options, cb){</span>
<span class="cstat-no" title="statement not covered" >  var submissionId = options.submissionId;</span>
<span class="cstat-no" title="statement not covered" >  logger.info('keeping flagged submission');</span>
<span class="cstat-no" title="statement not covered" >  cb(null);</span>
};
//remove submission
submissionSchema.statics.removeFlagged = <span class="fstat-no" title="function not covered" >function(options, cb){</span>
<span class="cstat-no" title="statement not covered" >  var submissionId = options.submissionId;</span>
<span class="cstat-no" title="statement not covered" >  var submissionDoc;</span>
<span class="cstat-no" title="statement not covered" >  logger.info('removing flagged submission');</span>
<span class="cstat-no" title="statement not covered" >  async.series([</span>
<span class="fstat-no" title="function not covered" >    function(done){</span>
      //remove the submission
      //TODO consider not removing incase there is some left over reference to it
<span class="cstat-no" title="statement not covered" >      Submission</span>
      .findOneAndRemove({_id: submissionId})
      .select('_id owner challenge')
      .populate({
        path: 'owner',
        select: 'id email _id'
      })
      .lean()
      .exec(<span class="fstat-no" title="function not covered" >function(err, submission){</span>
<span class="cstat-no" title="statement not covered" >        if (!err &amp;&amp; submission){</span>
          //hold on to the doc, we need it for other stuff
<span class="cstat-no" title="statement not covered" >          submissionDoc = submission;</span>
<span class="cstat-no" title="statement not covered" >          done(null);</span>
        } else {
<span class="cstat-no" title="statement not covered" >          err.clientMsg = 'Couldnt find and/or remove submission';</span>
<span class="cstat-no" title="statement not covered" >          done(err);</span>
        }
      });
    },
<span class="fstat-no" title="function not covered" >    function(done){</span>
      //send email to user
<span class="cstat-no" title="statement not covered" >      mailers.mailUserTerms({</span>
        email: submissionDoc.owner.email,
      });
<span class="cstat-no" title="statement not covered" >      done(null);</span>
    },
<span class="fstat-no" title="function not covered" >    function(done){</span>
      //clean up the challenge, remove submission from challenge, remove user from challenge
      //find the challenge
<span class="cstat-no" title="statement not covered" >      Challenge</span>
      .findOne({_id: submissionDoc.challenge})
      .select('submissions invites participants')
      .exec(<span class="fstat-no" title="function not covered" >function(err, challenge){</span>
        //remove submission from challenge
<span class="cstat-no" title="statement not covered" >        challenge.submissions.pull(submissionId);</span>
        //remove user from invites
<span class="cstat-no" title="statement not covered" >        challenge.invites.pull(submissionDoc.owner._id.toString());</span>
        //remove user from participants
<span class="cstat-no" title="statement not covered" >        challenge.participants.forEach(<span class="fstat-no" title="function not covered" >function(val, index){</span></span>
<span class="cstat-no" title="statement not covered" >          if (val.user.equals(submissionDoc.owner._id)){</span>
            //if user matches, remove subdoc at index and exit loop
<span class="cstat-no" title="statement not covered" >            challenge.participants.splice(index, 1);</span>
<span class="cstat-no" title="statement not covered" >            return true;</span>
          }
<span class="cstat-no" title="statement not covered" >          return false;</span>
        });
<span class="cstat-no" title="statement not covered" >        challenge.save(<span class="fstat-no" title="function not covered" >function(err, savedChallenge){</span></span>
<span class="cstat-no" title="statement not covered" >          if (!err){</span>
<span class="cstat-no" title="statement not covered" >            done(null);</span>
          } else {
<span class="cstat-no" title="statement not covered" >            err.clientMsg = 'Couldnt remove submission from challenge';</span>
<span class="cstat-no" title="statement not covered" >            done(err);</span>
          }
        });
      });
    },
<span class="fstat-no" title="function not covered" >    function(done){</span>
<span class="cstat-no" title="statement not covered" >      var errors = [];</span>
      //remove other comments from that user in other submissions in that challenge
<span class="cstat-no" title="statement not covered" >      Submission</span>
      .find({'comments.commenter': submissionDoc.owner._id.toString(),
             'challenge': submissionDoc.challenge}) //match only in that challenge, not all challenges
      .select('comments challenge')
      .exec(<span class="fstat-no" title="function not covered" >function(err, submissions){</span>
<span class="cstat-no" title="statement not covered" >        if (!err &amp;&amp; submissions &amp;&amp; submissions.length){</span>
          //go through each submission in the challenge
<span class="cstat-no" title="statement not covered" >          submissions.forEach(<span class="fstat-no" title="function not covered" >function(submission, index){</span></span>
            //in each submission check all the comments
<span class="cstat-no" title="statement not covered" >            submissions[index].comments.forEach(<span class="fstat-no" title="function not covered" >function(comment, cindex){</span></span>
              //check each comment for a user match, if so remove/splice that
<span class="cstat-no" title="statement not covered" >              if (comment.commenter.equals(submissionDoc.owner._id)){</span>
                //if this is a comment of the kicked commenter, remove it
<span class="cstat-no" title="statement not covered" >                submissions[index].comments.splice(cindex, 1);</span>
              }
            });
            //save each submission
            //TODO only save the modified ones
<span class="cstat-no" title="statement not covered" >            submissions[index].save(<span class="fstat-no" title="function not covered" >function(err){</span></span>
<span class="cstat-no" title="statement not covered" >              if (err){</span>
                //since we have multiple saves, add to error array
<span class="cstat-no" title="statement not covered" >                errors.push(err);</span>
              }
            });
          });
<span class="cstat-no" title="statement not covered" >          if (errors.length === 0){</span>
            //no errors in the process, lets finish up here
<span class="cstat-no" title="statement not covered" >            done(null);</span>
          } else {
            //we had some errors after all that
<span class="cstat-no" title="statement not covered" >            done(errors);</span>
          }
        } else <span class="cstat-no" title="statement not covered" >if (!err) {</span>
<span class="cstat-no" title="statement not covered" >          logger.debug('Didnt remove any comments');</span>
        } else {
<span class="cstat-no" title="statement not covered" >          err.clientMsg = 'Didnt remove any comments';</span>
<span class="cstat-no" title="statement not covered" >          logger.error('Error removing comments');</span>
<span class="cstat-no" title="statement not covered" >          done(err);</span>
        }
      });
    },
<span class="fstat-no" title="function not covered" >    function(done){</span>
      //increment user badSubmissions value
<span class="cstat-no" title="statement not covered" >      User</span>
      .findOne({_id: submissionDoc.owner._id})
      .select('badSubmissions')
      .exec(<span class="fstat-no" title="function not covered" >function(err, user){</span>
<span class="cstat-no" title="statement not covered" >        if (!err &amp;&amp; user){</span>
<span class="cstat-no" title="statement not covered" >          user.incrementBadSubmissions(<span class="fstat-no" title="function not covered" >function(err){</span></span>
<span class="cstat-no" title="statement not covered" >            if (!err){</span>
<span class="cstat-no" title="statement not covered" >              done(null);</span>
            } else {
<span class="cstat-no" title="statement not covered" >              done(err);</span>
            }
          });
        } else {
<span class="cstat-no" title="statement not covered" >          err.clientMsg = 'Couldnt find user to increment';</span>
<span class="cstat-no" title="statement not covered" >          done(err);</span>
        }
      });
    },
<span class="fstat-no" title="function not covered" >    function(done){</span>
      //remove the submission activities regarding that submission
<span class="cstat-no" title="statement not covered" >      Activity</span>
      .find({'references.submission':submissionDoc._id})
      .remove()
      .exec(<span class="fstat-no" title="function not covered" >function(err, activities){</span>
<span class="cstat-no" title="statement not covered" >        if (err){</span>
          //if error, let it proceed to next step just let the server know
<span class="cstat-no" title="statement not covered" >          logger.error('Error! Could not delete activities', {err: err, stack: new Error().stack});</span>
        }
<span class="cstat-no" title="statement not covered" >        done(null);</span>
      });
    },
<span class="fstat-no" title="function not covered" >    function(done){</span>
      //remove the comments activities regarding that user in that challenge 
<span class="cstat-no" title="statement not covered" >      Activity</span>
      .find({
        'references.challenge': submissionDoc.challenge,
        'subject': submissionDoc.owner._id
      })
      .remove()
      .exec(<span class="fstat-no" title="function not covered" >function(err, activities){</span>
<span class="cstat-no" title="statement not covered" >        if (err){</span>
          //if error, let it proceed to next step just let the server know
<span class="cstat-no" title="statement not covered" >          logger.error('Error! Could not delete activities', {err: err, stack: new Error().stack});</span>
        }
<span class="cstat-no" title="statement not covered" >        done(null);</span>
      });
    }],
<span class="fstat-no" title="function not covered" >    function(err, results){</span>
<span class="cstat-no" title="statement not covered" >      if (!err){</span>
<span class="cstat-no" title="statement not covered" >        logger.info('Removed submission:', submissionDoc._id.toString(), ' and all references to it');</span>
      } else {
<span class="cstat-no" title="statement not covered" >        logger.error('Error! Could not properly cleanup submission: ', submissionDoc, {err: err, stack: new Error().stack});</span>
<span class="cstat-no" title="statement not covered" >        cb(err);</span>
      }
&nbsp;
  });
};
//flag submission
submissionSchema.statics.flag = function(options, cb){
  var submissionId = options.submissionId;
  var flaggerId = options.flagger;
  async.waterfall([
    function(done){
      //first add flagger to submission
      Submission
      .findOne({_id: submissionId})
      .select('challenge _id flaggers owner image thumbnail')
      .populate({
        path: 'owner',
        select: 'email username'
      })
      .exec(function(err, submission){
        <span class="missing-if-branch" title="else path not taken" >E</span>if (!err &amp;&amp; submission){
          submission.flaggers.addToSet(flaggerId);
          submission.save(function(err, savedSubmission){
            <span class="missing-if-branch" title="else path not taken" >E</span>if (!err &amp;&amp; savedSubmission){
              done(null, savedSubmission);
            } else {
<span class="cstat-no" title="statement not covered" >              done(err, null);</span>
            }
          });
        } else {
<span class="cstat-no" title="statement not covered" >          done(err, null);</span>
        }
      });
    },
    function(submission, done){
      //check if past flag threshold and send email if that is the case
      if (submission.flaggers.length &gt;= config.flagThreshold){
        logger.info('Submission past flag threashold: %d', config.flagThreshold);
        //populate the fields needed for sending in the email
        //send out an email to the moderator giving information on the bad submission
        mailers.moderateSubmission({
          flaggedUserEmail: submission.owner.email,
          image: submission.image,
          challengeId: submission.challenge.toString(),
          submissionId: submission.id
        });
      }
      done(null);
    }
  ], function(err, reslts){
    //handle the errors here
    <span class="missing-if-branch" title="else path not taken" >E</span>if (!err){
      cb(null);
    } else {
<span class="cstat-no" title="statement not covered" >      cb(err);</span>
    }
  });
};
//find challenge of a submission //TODO, we already store this, why the hell are we looking for it!?
submissionSchema.methods.findChallenge = function(next){
  //find the challenge this submissions exists in and pass that to the callback
  Challenge
    .findOne({submissions: this._id})
    .populate({
      path: 'submissions', //populate submissions in the challenge
      select: 'score' //but only select submissions.score as that is all we will need
    })
    .select('submissions')//also only pass back challenge.submissions, we don't need the other challenge props
    .exec(function(err, challenge){
      <span class="missing-if-branch" title="else path not taken" >E</span>if (!err &amp;&amp; challenge){
        next(null, challenge);
      } else {
<span class="cstat-no" title="statement not covered" >        next(err, null);</span>
      }
    });
};
&nbsp;
//calculate the rank of an image
submissionSchema.methods.getRank = function(next){
  //we have a virtual that we use to get the rank of the submission
  var submission = this; //keep this for when context changes
  //find the challenge this submission belongs to so we can get all the submissions in the group
  this.findChallenge(function(err, challenge){
    <span class="missing-if-branch" title="else path not taken" >E</span>if (!err &amp;&amp; challenge){
      //sort the submissions in this challenge ordering by 'score'
      var sortedSubmissions = _.sortBy(challenge.toJSON().submissions, 'score'); //sort in ascending order by score
      sortedSubmissions = _.chain(sortedSubmissions).reverse().value(); //reverse the order so it is in descending order
      //now find where our submissions is in this sorted list
      var index = _.chain(sortedSubmissions).map(function(obj){
        return obj._id.toJSON(); //need to get the string version of the id
      }).indexOf(submission.id).value(); //find the index of the submission in the ordered array that matches the submission we are looking for
      //return that place in the ranking
      next(index + 1); //add one to the index to get the rank
    } else {
<span class="cstat-no" title="statement not covered" >      next(-1); </span>//some sort of error to investigate
    }
  });
};
&nbsp;
//help addImage to a submission
submissionSchema.methods.addImage = function(req, next){
  var gm = require('gm');
  var im = gm.subClass({ imageMagick: true });
  <span class="missing-if-branch" title="else path not taken" >E</span>if (req.files){ //see if there are files first //TODO, this may not be a good way to see if files are there
    var uploadedImage = req.files[Object.keys(req.files)[0]]; //get the first file in the list of files
    this.image.contentType = uploadedImage.type;
    this.image.data = fs.readFileSync(uploadedImage.path); //TODO, this should be async, this is blocking and slow
    //TODO cleanup this file also
    //make the thumbnail too
    var thumbPath = uploadedImage.path + "thumb"; //set thumb path for future use
    var that = this;
    im(uploadedImage.path).thumb(90, 90, thumbPath, 90, //should go in own addThumbnail function
      function(err, stdout, stderr, command){
        that.thumbnail.contentType = uploadedImage.type;
        that.thumbnail.data = fs.readFileSync(thumbPath);
        next();
      });
&nbsp;
  } else {
<span class="cstat-no" title="statement not covered" >    next();</span>
  }
};
//Build the submission model
var Submission = mongoose.model('Submission', submissionSchema);
&nbsp;
module.exports = Submission;
&nbsp;</pre></td></tr>
</table></pre>

</div>
<div class="footer">
    <div class="meta">Generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Wed Oct 01 2014 22:00:21 GMT+0530 (IST)</div>
</div>

<script src="../../prettify.js"></script>

<script src="https://yui-s.yahooapis.com/3.6.0/build/yui/yui-min.js"></script>
<script>

    YUI().use('datatable', function (Y) {

        var formatters = {
          pct: function (o) {
              o.className += o.record.get('classes')[o.column.key];
              try {
                  return o.value.toFixed(2) + '%';
              } catch (ex) { return o.value + '%'; }
          },
          html: function (o) {
              o.className += o.record.get('classes')[o.column.key];
              return o.record.get(o.column.key + '_html');
          }
        },
          defaultFormatter = function (o) {
              o.className += o.record.get('classes')[o.column.key];
              return o.value;
          };

        function getColumns(theadNode) {
            var colNodes = theadNode.all('tr th'),
                cols = [],
                col;
            colNodes.each(function (colNode) {
                col = {
                    key: colNode.getAttribute('data-col'),
                    label: colNode.get('innerHTML') || ' ',
                    sortable: !colNode.getAttribute('data-nosort'),
                    className: colNode.getAttribute('class'),
                    type: colNode.getAttribute('data-type'),
                    allowHTML: colNode.getAttribute('data-html') === 'true' || colNode.getAttribute('data-fmt') === 'html'
                };
                col.formatter = formatters[colNode.getAttribute('data-fmt')] || defaultFormatter;
                cols.push(col);
            });
            return cols;
        }

        function getRowData(trNode, cols) {
            var tdNodes = trNode.all('td'),
                    i,
                    row = { classes: {} },
                    node,
                    name;
            for (i = 0; i < cols.length; i += 1) {
                name = cols[i].key;
                node = tdNodes.item(i);
                row[name] = node.getAttribute('data-value') || node.get('innerHTML');
                row[name + '_html'] = node.get('innerHTML');
                row.classes[name] = node.getAttribute('class');
                //Y.log('Name: ' + name + '; Value: ' + row[name]);
                if (cols[i].type === 'number') { row[name] = row[name] * 1; }
            }
            //Y.log(row);
            return row;
        }

        function getData(tbodyNode, cols) {
            var data = [];
            tbodyNode.all('tr').each(function (trNode) {
                data.push(getRowData(trNode, cols));
            });
            return data;
        }

        function replaceTable(node) {
            if (!node) { return; }
            var cols = getColumns(node.one('thead')),
                data = getData(node.one('tbody'), cols),
                table,
                parent = node.get('parentNode');

            table = new Y.DataTable({
                columns: cols,
                data: data,
                sortBy: 'file'
            });
            parent.set('innerHTML', '');
            table.render(parent);
        }

        Y.on('domready', function () {
            replaceTable(Y.one('div.coverage-summary table'));
            if (typeof prettyPrint === 'function') {
                prettyPrint();
            }
        });
    });
</script>
</body>
</html>
